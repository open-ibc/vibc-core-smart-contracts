// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.0;

import "forge-std/Test.sol";
import {SigningBase} from "../utils/Signing.base.t.sol";
import {CrossL2Prover} from "contracts/core/proofAPI/CrossL2Prover.sol";
import {SequencerSignatureVerifier} from "contracts/core/SequencerSignatureVerifier.sol";

import {ISignatureVerifier} from "contracts/interfaces/ISignatureVerifier.sol";
import {ICrossL2Prover} from "contracts/interfaces/ICrossL2Prover.sol";
import {Ics23Proof} from "contracts/interfaces/IProofVerifier.sol";
import {MerkleTrie} from "optimism/libraries/trie/MerkleTrie.sol";

contract CrossL2InboxBase is SigningBase {
    using stdJson for string;

    CrossL2Prover crossProver;

    // Sequencer signing related
    bytes invalidSignature;
    bytes validAncestorSignature;

    // Proof related
    bytes32 receiptRoot;
    bytes receiptIdx;
    bytes rlpEncodedReceipt;
    bytes[] receiptProof;
    bytes32 logHash;
    uint256 logIdx;
    string peptideClientId;

    function setUp() public {
        crossProver = new CrossL2Prover(sigVerifier, peptideClientId);

        // Used for l1 origin check tests, represents the child block.
        bytes32 ancestorPayloadHash =
            keccak256(bytes.concat(bytes32(peptideBlockNumber), peptideAppHash, l1AncestorBlockHash));
        bytes32 ancestorHashToSign = keccak256(bytes.concat(domain, PEPTIDE_CHAIN_ID, ancestorPayloadHash));
        (uint8 v0, bytes32 r0, bytes32 s0) = vm.sign(sequencerPkey, ancestorHashToSign);
        validAncestorSignature = abi.encodePacked(r0, s0, v0); // Annoingly, v, r, s are in a different order than those

        (uint8 v1, bytes32 r1, bytes32 s1) = vm.sign(notSequencerPkey, ancestorHashToSign);
        invalidSignature = abi.encodePacked(r1, s1, v1); // Annoingly, v, r, s are in a different order than those

        receiptRoot = hex"91de58019987854102326f49d235578cec08f71ddd5333c9e340ed63149d24a4";
        receiptIdx = hex"01";

        rlpEncodedReceipt =
            hex"02f9038801834008fdb9010000000000000001000000000000000000000000000000000000040000000001000000000000000000000000100000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000008000000000010000000000000400000000000000000000000200000000000000000002000000000000000040000000000000000000000001002100000000000020000000000000000000000000000000010000000000400000000000000000000000000000000000000000000000000000000000000000180000200000000000000080000020000002000000000000000000000000000000000000400000000000000000f9027df87a944200000000000000000000000000000000000006f842a0e1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109ca00000000000000000000000006f26bf09b1c792e3228e5467807a900a503c0281a0000000000000000000000000000000000000000000000000051ef38b821e8000f901fe946f26bf09b1c792e3228e5467807a900a503c0281f884a0a123dc29aebf7d0c3322c8eeb5b999e859f39937950ed31056532713d0de396fa00000000000000000000000000000000000000000000000000000000000002105a00000000000000000000000000000000000000000000000000000000000203bfba00000000000000000000000009d3976c25f4defe584ed80bae5a7cef59ba07aa5b9016000000000000000000000000042000000000000000000000000000000000000060000000000000000000000004200000000000000000000000000000000000006000000000000000000000000000000000000000000000000051ef38b821e8000000000000000000000000000000000000000000000000000051ebff283cb65ba00000000000000000000000000000000000000000000000000000000670d39ab00000000000000000000000000000000000000000000000000000000670d8f1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009d3976c25f4defe584ed80bae5a7cef59ba07aa5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000";

        logIdx = 1;
        receiptProof.push(
            hex"f891a0022a3a4141798ccc5b3d76565985c487f80d33c6d84c50681cacee53b7a1178aa05ea06d2cf663de8c05b78213a955c261d00cadd02dc60e5705cf8d7a6301fa7ea0a2cc6ca974174d203b891af5e00478e5f0515a8d0d436bd364958c89ee2b7a9c8080808080a05fa8cd42f989c3e3f4284ed784084e0f76ae0177e0d9efcace1dc6581819a53b8080808080808080"
        );
        receiptProof.push(
            hex"f90211a0c6d0a721cb31a7891a8fe6523fc8584fccbfdb50be81c0fd01514a6957ed7a1ba0d1a3b1372c1f53ffc668d023c054a227f737d21c5bb6342b30b77768d49aee07a0b4bfeb55218638db2e47dd18adee34ae9e7671790b50cfa0c25e4c91d7063308a0258e54f2e2230e65b0c3bcf0e975c708fa47d0268a6edceb0a8c322a266ddae0a0941a0ad1b44e45c8172a64f4e3e5e19bf47ec9e658515a294e17a52cb06277e2a03ad24c4887b623835a1028075321979578f6f940c442f3a173dd3967d5265bd7a07d1c077612de47ddf1a529ba5121d37db2859152562c57200687e37ad824ca8da0c99732203600dd41c8c247fa02eb7fb36e07627e900503e18dfaa29e653ff41fa0f3fb8db5579d90247fe06e13eb005191c9f33a6c1b418b6158200e3ebb5d0b0da0fcb23b65537675bc4eda2665ff7c58a34674dbaa50a98a6fe96156eb3767789da0250c1b48df8b7f41248441bec7f15e52f4463d0e8f9ae2f309fc10055ed0bfeca08673eba5254e10ddc189815e9e6d2c39d34f7095f40799271422ac796d74171ca02ea80e05b1398bd61f3b2702821dc6bd1f23b421ee943f02feec5fd66f36ae84a0709c2c5a5cbc93c6aff26d96dd867fa7ec57cf6e7daaf39c0918a74fca7b296ba0492df7ac62065ddfdac36054c9dec14539b908a4be45388f6df89aa441df559ba05b66c22bbabcaf4b91e812bce87f23b5d4b2299c5418c6c6e82a4d38d3faad8780"
        );
        receiptProof.push(
            hex"f9039020b9038c02f9038801834008fdb9010000000000000001000000000000000000000000000000000000040000000001000000000000000000000000100000000000000000000000000001000000000000000000000000000000000000000000000000000000000000000000008000000000010000000000000400000000000000000000000200000000000000000002000000000000000040000000000000000000000001002100000000000020000000000000000000000000000000010000000000400000000000000000000000000000000000000000000000000000000000000000180000200000000000000080000020000002000000000000000000000000000000000000400000000000000000f9027df87a944200000000000000000000000000000000000006f842a0e1fffcc4923d04b559f4d29a8bfc6cda04eb5b0d3c460751c2402c5c5cc9109ca00000000000000000000000006f26bf09b1c792e3228e5467807a900a503c0281a0000000000000000000000000000000000000000000000000051ef38b821e8000f901fe946f26bf09b1c792e3228e5467807a900a503c0281f884a0a123dc29aebf7d0c3322c8eeb5b999e859f39937950ed31056532713d0de396fa00000000000000000000000000000000000000000000000000000000000002105a00000000000000000000000000000000000000000000000000000000000203bfba00000000000000000000000009d3976c25f4defe584ed80bae5a7cef59ba07aa5b9016000000000000000000000000042000000000000000000000000000000000000060000000000000000000000004200000000000000000000000000000000000006000000000000000000000000000000000000000000000000051ef38b821e8000000000000000000000000000000000000000000000000000051ebff283cb65ba00000000000000000000000000000000000000000000000000000000670d39ab00000000000000000000000000000000000000000000000000000000670d8f1000000000000000000000000000000000000000000000000000000000000000000000000000000000000000009d3976c25f4defe584ed80bae5a7cef59ba07aa5000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000001400000000000000000000000000000000000000000000000000000000000000000"
        );
    }

    // // Happy path for CrossEventProver.updateClient()
    // function test_clientUpdate_success() public {
    //     crossProver.updateClient(
    //         abi.encodePacked(l1AncestorBlockHash, validAncestorSignature), peptideBlockNumber,
    // uint256(peptideAppHash)
    //     );
    //     assertEq(crossProver.getState(peptideBlockNumber), uint256(peptideAppHash));
    // }

    // Happy path for CrossEventProver.validateReceipt()
    function test_validate_receipt_success() public {
        // TODO: Fill this in once we have relaying to peptide working and that we can generate peptide state proof
        // using this tool in relayer code at polymerase/
        // 1.) Run the oprelayer/pkg/encoder/cmd/main.go command to generate hex files  (note: this will need to be
        // modified to work with receipt proofs instead of channel/packet proofs)
        // 2.) load these proof files into the test contracts using the load_proof util, e.g. using something like
        // Ics23Proof memory testProof = load_proof("/test/payload/channel_confirm_pending_proof.hex",
        // address(dummyLightClient));
        // 3.) Run the validate_receipt call below

        bytes memory updateD1 =
            hex"49ff245e000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000f31ee4fb51b81611f9905678f18d61499be2045ce5ac32b31a8d2990099e1636d57560000000000000000000000000000000000000000000000000000000000000061ad570a3faf8ca0ec6cef9f7ba5b62b3adde5ab7464e78575cdd642b0878717166614e4d3e3f2072070ca7c2cdb3b8049beb2683cae1c24c0aae7679ffba50e0b5e31d0c6bb70405ca2c2f0457c8f24eef1e37025bd793545392f35bad2edf9ec1b00000000000000000000000000000000000000000000000000000000000000";

        bytes memory cdataI =
            hex"00000000000000000000000000000000000000000000000000000000000000c0000000000000000000000000000000000000000000000000000000000000188045ee615a449d7d2bafef6dab636a705d495d73b7e36317a66b14b4aa42373f49000000000000000000000000000000000000000000000000000000000146f7a00000000000000000000000000000000000000000000000000000000000001de00000000000000000000000000000000000000000000000000000000000001e20000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000f31ef0000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000011a00000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000108000000000000000000000000000000000000000000000000000000000000010e000000000000000000000000000000000000000000000000000000000000011200000000000000000000000000000000000000000000000000000000000000011000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000004800000000000000000000000000000000000000000000000000000000000000540000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000006c000000000000000000000000000000000000000000000000000000000000007800000000000000000000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000009c00000000000000000000000000000000000000000000000000000000000000aa00000000000000000000000000000000000000000000000000000000000000b800000000000000000000000000000000000000000000000000000000000000c600000000000000000000000000000000000000000000000000000000000000d400000000000000000000000000000000000000000000000000000000000000e200000000000000000000000000000000000000000000000000000000000000f00000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270204dac779208c887f3453047d7c42d2fe1bfb9db3fad1efe429ef1a6161babeddab2395cf7f200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000060406dac77920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212068d867c4564931a275990b112693de0763e5a121dcfd012b6db1d17c0208f23700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000027060adac77920189c540348af7e7cd5657e9bb7d79fed7a43182353b764d2748bf74669e031f420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270812dac77920c22fc764f56af66976f1fd92eef6c2e87a600bdbd6e2cfd333d0a3da2e2a728820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270a22dac779204a4d91e24348ec556515e5a2f13ad8acb4449e08673579f05e867a734cdcb1f520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270c42dac779205ec8c0ea8a7180bfb43f0136ab094f48250126c6c5c09caeca6ef7b1bd85f27920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000280e8201dac77920825144eb0122bd0bd7688cd9637e69c6045dd73cca6891728f191050b4346ef7200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000028108203dac779208b841bfb9130269652e9343140544209767864c1c6751603e87ff8bf04d00bfa200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002812ea04dac77920de1597375cea2351720d5e85d7776def40a51ccaf5a07aaa3f576271203e4e03200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002814e609dac779209ddefb98792fbea89b1898717cdfee1845cfe830d9b4ec9780e3a41e5ff62c6a20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000716e80ddac779200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212092fac0fb8dcfe42099dbfa132b415a3f879e9192941e079da522178afe464fcb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000718d019dac7792000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120794589d56027a0878e170689fd18872b27cf231bd5e2d3f8bba6eda045fa0e3c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000071aa638dac779200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212030501d580df120421bef6d91cc193b5ee1dc8c9dd00ccd3e0e4ebc13ab2776ae000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000071c8e5ddac7792000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120659df35a3862ec7f0565d27d4948eb35405dae10d3374dc9f2815801486c86fa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000081ec8b001dac77920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120c276954e8004bb3e64694d236bbca72f70cbb7432d250833b8cfe49b4590528a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000820e0c102dac7792000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212090c1755318788e1d2a2d362e31fe02a437cf3e8b9419a2ec9262a55a8921acd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000822aae204dac77920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120eaaca135ea4eba11d05337c7f6c0a56e68a95cb6522b94793e158600d07c679c00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003c636861696e2f31313135353432302f73746f72656452656365697074732f70726f6f665f6170692f72656365697074526f6f742f323134323831323800000000000000000000000000000000000000000000000000000000000000000000002045ee615a449d7d2bafef6dab636a705d495d73b7e36317a66b14b4aa42373f4900000000000000000000000000000000000000000000000000000000000000050002dac7790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000580000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000000000003a00000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002055b2431950eb845ab774b65d0b2106321e9bc574554e65ef2994f7c556f5ff72000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002101bb179066e7a59d6957dc53e9ada2070e6a24cc0588890c871aada61e7a9f951a000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000021013a0166ce781bb81d6c0cff7202cb9201c22aa03228564f3d4c38f5267b08cb50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000210123828cb6358a0d4737bc4635188a6bb81686911e35a2bc8f1aa71e5dcb7f747200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020cb8f60af1f2e02e4101d0be2a5c89be629ccc3a090e9b03c95ce0d9d5d2f13850000000000000000000000000000000000000000000000000000000000000007706f6c79696263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020a511cbf2f1ac2a4e0ee247304b5c3db87eace4b2cbb1554b187cdddeb82ce353000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000001a00000000000000000000000000000000000000000000000000000000000000053f851a04ade41929f9960dc8b23d309e7bc683a2d3a7e05953c881725b09e6f7bc22f8480808080808080a0a7df9b69b3dee917b7b9ada7c483f3dc6f4434b436581f1ddad64278f74a55308080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000093f89180a027ed880faef32d788859dcfa655781054030b96cf1601adca5a3a1f4ea98c354a0d15aae4d98912270475d1e8da972b70f0e3f93f582b05e7a959b260082b3b388a0182f07e61d249ff8522ee4df1d1b41dec8c3c27981e8019203eb93897a5038c6a017dea238c3f712fc3e290aea7348dddd4e6c019967cd321a2485a9276c8ab804808080808080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000374f9037120b9036d02f9036901830203f5b9010000000000000000000000000000000000000008000000000000000000200000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000800000000000000000001000000200000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000800000001000000000004000000000000000000000000080000000000000000400000000000000000000400000000000000100000000000000040000002000400000000000000000000000200000300000000000004000000000000000000000000000000f9025ef8bc94f221750e52aa080835d2957f2eed0d5d7ddd8c38f884a0890b8d3b4a67090e510bd923450d355a7fb174ec26ddaf6bdb82fc453e27aa7fa05792542d502e7f45a33860568125dc5f35fd1b256c02e5a127e3c2a223ac151fa0000000000000000000000000000000000000000000000000000000000146f7a0a000000000000000000000000066cc4863000ea4a5734e97a704b0827f7b205302a0000000000000000000000000000000000000000000000000000000006764caecf9019d94f221750e52aa080835d2957f2eed0d5d7ddd8c38f863a03bb399125b923176baf5098f432689e4843dee54b68daf1d7cadd91d99a63601a05792542d502e7f45a33860568125dc5f35fd1b256c02e5a127e3c2a223ac151fa06172627400000000000000000000000000000000000000000000000000000000b90120000000000000000000000000000000000000000000000000000000000000000000000000000000000000000066cc4863000ea4a5734e97a704b0827f7b205302000000000000000000000000000000000000000000000000015b540c417b595600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000016345785d8a0000000000000000000000000000000000000000000000000000000000000146f7a000000000000000000000000066cc4863000ea4a5734e97a704b0827f7b205302000000000000000000000000000000000000000000000000000000006764caec0000000000000000000000000000000000000000000000000000000000000000000000000000000000000008313131353534323000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000";

        bytes memory updateD =
            hex"49ff245e000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000f3235ebf1f4c1903364fef5ed8c01dfae471e3cad3c521faa4b555b091797ad3715fd0000000000000000000000000000000000000000000000000000000000000061942274c49ba58502fc05f2bb301568efd13488d4373ee29164337d2d12fb0911c3552747b3cc61f98dda979cb0470eeb29b20f4d9a6236cebb6c3b71bb236b4b4ec43436502e35cb8298b0d4016c4b9a7351596df14eac3a661fa48cc5e7b47e1c00000000000000000000000000000000000000000000000000000000000000";
        bytes memory cdata =
            hex"00000000000000000000000000000000000000000000000000000000000000c00000000000000000000000000000000000000000000000000000000000001880be52b1369b864cfb1ec31e150da329d0cf35f3eb06a9aef4237076f6664aebb9000000000000000000000000000000000000000000000000000000000146f8140000000000000000000000000000000000000000000000000000000000001ca00000000000000000000000000000000000000000000000000000000000001ce0000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000f32360000000000000000000000000000000000000000000000000000000000000002000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000011a00000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000108000000000000000000000000000000000000000000000000000000000000010e0000000000000000000000000000000000000000000000000000000000000112000000000000000000000000000000000000000000000000000000000000000110000000000000000000000000000000000000000000000000000000000000220000000000000000000000000000000000000000000000000000000000000030000000000000000000000000000000000000000000000000000000000000003c000000000000000000000000000000000000000000000000000000000000004800000000000000000000000000000000000000000000000000000000000000540000000000000000000000000000000000000000000000000000000000000060000000000000000000000000000000000000000000000000000000000000006c000000000000000000000000000000000000000000000000000000000000007800000000000000000000000000000000000000000000000000000000000000840000000000000000000000000000000000000000000000000000000000000090000000000000000000000000000000000000000000000000000000000000009c00000000000000000000000000000000000000000000000000000000000000aa00000000000000000000000000000000000000000000000000000000000000b800000000000000000000000000000000000000000000000000000000000000c600000000000000000000000000000000000000000000000000000000000000d400000000000000000000000000000000000000000000000000000000000000e200000000000000000000000000000000000000000000000000000000000000f000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000060204e8c87920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212068d867c4564931a275990b112693de0763e5a121dcfd012b6db1d17c0208f23700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270408e8c879205bebf95fbb71c36f0f7fb206792b18e92930f0801ee3d5d50128a1835fa6cb1720000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000027060ce8c87920189c540348af7e7cd5657e9bb7d79fed7a43182353b764d2748bf74669e031f420000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270814e8c87920c22fc764f56af66976f1fd92eef6c2e87a600bdbd6e2cfd333d0a3da2e2a728820000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270a24e8c879204a4d91e24348ec556515e5a2f13ad8acb4449e08673579f05e867a734cdcb1f520000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000270c44e8c879205ec8c0ea8a7180bfb43f0136ab094f48250126c6c5c09caeca6ef7b1bd85f27920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a000000000000000000000000000000000000000000000000000000000000000280e8401e8c87920825144eb0122bd0bd7688cd9637e69c6045dd73cca6891728f191050b4346ef7200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000028108403e8c879208b841bfb9130269652e9343140544209767864c1c6751603e87ff8bf04d00bfa200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002812ec04e8c87920de1597375cea2351720d5e85d7776def40a51ccaf5a07aaa3f576271203e4e03200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002814e809e8c879209ddefb98792fbea89b1898717cdfee1845cfe830d9b4ec9780e3a41e5ff62c6a20000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000716ea0de8c879200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212092fac0fb8dcfe42099dbfa132b415a3f879e9192941e079da522178afe464fcb0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000718d219e8c8792000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120794589d56027a0878e170689fd18872b27cf231bd5e2d3f8bba6eda045fa0e3c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000071aa838e8c879200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212030501d580df120421bef6d91cc193b5ee1dc8c9dd00ccd3e0e4ebc13ab2776ae000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000071c905de8c8792000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120659df35a3862ec7f0565d27d4948eb35405dae10d3374dc9f2815801486c86fa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000040000000000000000000000000000000000000000000000000000000000000008000000000000000000000000000000000000000000000000000000000000000081ecab001e8c87920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120c276954e8004bb3e64694d236bbca72f70cbb7432d250833b8cfe49b4590528a0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000820e2c102e8c8792000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000212090c1755318788e1d2a2d362e31fe02a437cf3e8b9419a2ec9262a55a8921acd50000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000822b0e204e8c87920000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000002120fc157bf253e38344cc45b731d6c50a2ed7d07739b24aac857d75a2f7f1eac95a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003c636861696e2f31313135353432302f73746f72656452656365697074732f70726f6f665f6170692f72656365697074526f6f742f3231343238323434000000000000000000000000000000000000000000000000000000000000000000000020be52b1369b864cfb1ec31e150da329d0cf35f3eb06a9aef4237076f6664aebb900000000000000000000000000000000000000000000000000000000000000050002e8c8790000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000050000000000000000000000000000000000000000000000000000000000000005400000000000000000000000000000000000000000000000000000000000000580000000000000000000000000000000000000000000000000000000000000000500000000000000000000000000000000000000000000000000000000000000a00000000000000000000000000000000000000000000000000000000000000160000000000000000000000000000000000000000000000000000000000000022000000000000000000000000000000000000000000000000000000000000002e000000000000000000000000000000000000000000000000000000000000003a000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020bf2ef85d8555932ee5207b5477366a7852362e8e4c2ef9c6d690e9cef2066de5000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002101e00d1c5bb1e5262db18742e628cd8f5790d56c2a9bbee2abe9a83410a7a0ce5c000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002101167f3b5ec1d23818b1779a084f53b3d071f23611048f5af1cca1e790dc4c23f4000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000004000000000000000000000000000000000000000000000000000000000000000a0000000000000000000000000000000000000000000000000000000000000002101944fd9266b375e06565138330b0bc155a3c4eab9d3e6f6fea1ec496e7116a0ee00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000080000000000000000000000000000000000000000000000000000000000000000101000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020e46c86c33f052a34cdaf84a9839be791f6aba5f9d9bcf164c589bf554e80a0fa0000000000000000000000000000000000000000000000000000000000000007706f6c79696263000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000020dbdb8d76093d90066f31896cad13b34883c81c9b5014340f04f09f09f0dff977000000000000000000000000000000000000000000000000000000000000000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000003000000000000000000000000000000000000000000000000000000000000006000000000000000000000000000000000000000000000000000000000000000e000000000000000000000000000000000000000000000000000000000000002200000000000000000000000000000000000000000000000000000000000000053f851a0dd2d6a7e2591c212bee8440369ae247b713ca47cac62a3d0b9aabb30c4bb8e0f80808080808080a050c4f0f512105d06565eef878860d3ba6c33781255b52394612b5706ff03c4ee8080808080808080000000000000000000000000000000000000000000000000000000000000000000000000000000000000000114f9011180a028b5370fe88830dfaaa1e3384490f18c9807d5626b436b7e6266b6652e84bb2ba05669668454156bacd4bf50643f3f86eed543f7004bc6c3771485413a6a193263a08205e2c4ada70f126b4758234c95b55373a9d88eb54828445b7e1813614f8ef8a0ebef4edb01fb2529d8f8cecac7ef58bf65eaad0024cd32e7ec7e53cd81de098fa0d82710c3a51fd1a4a433914d409c94b6400b4c7c3f533ccacefcc59da1900151a09eca1ebeafe12c18658d1ef88e82174399127e73c4e943b8a7cccea9e7bb302fa06bb4e4a887fffef3fbaf4c9e65e7deb10b89a9423306639e0ab3791c87d32848a079bcdd551ba286fb9a7489bfe78f71755861f10e4abfdce0d582047e6a8516ce808080808080808000000000000000000000000000000000000000000000000000000000000000000000000000000000000001b1f901ae20b901aaf901a70183019ec7b9010020000000000000000008000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000280000000000000000400000100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000400000000000000000000000000000000000000000000000000000000000000000000020000001000000000000000000000000000080000000000000000000000000000800000000000000000000000000000000000000000000000000000000000000010000000000000000000000000000000000000000000000000000000000000f89df89b94464c8ec100f2f42fb4e42e07e203da2324f9fc67f863a08c5be1e5ebec7d5bd14f71427d1e84f3dd0314c0f7b2291e5b200ac8c7c3b925a0000000000000000000000000fdb9629ad5a3b417d3e08730e9ccc9f616d8125fa00000000000000000000000003267e72dc8780a1512fa69da7759ec66f30350e3a0000000000000000000000000000000000000000000000000011951ebd5dc0ad00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000008313131353534323000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000010100000000000000000000000000000000000000000000000000000000000000";

        SequencerSignatureVerifier sigV = new SequencerSignatureVerifier(
            address(0x11a72195e668328fEe607a309EfA2C42B2893E1d),
            bytes32(0x0000000000000000000000000000000000000000000000000000000000000385)
        );

        // SequencerSignatureVerifier sigV = new SequencerSignatureVerifier(
        //     address(0xf029563823C84983AdC20fEA201889b566cAa005),
        //     bytes32(0x0000000000000000000000000000000000000000000000000000000001bc1bc1)
        // );

        CrossL2Prover cpI = new CrossL2Prover(sigV, "proof_api");
        (bool success, bytes memory returnData) = address(cpI).call(updateD);
        require(success, "Call to client update failed");
        (success, returnData) = address(cpI).call(updateD1);
        require(success, "Call to client update failed");
        cpI.validateReceipt(cdata);
        cpI.validateEvent(0, cdata);
        cpI.validateEvent(0, cdataI);
    }

    // Happy path for CrossEventProver.validateEvent()
    function test_validate_event_success() public {
        // TODO: Fill this in once we have relaying to peptide working and that we can generate peptide state proof
        // using this tool in relayer code at polymerase/
        // 1.) Run the oprelayer/pkg/encoder/cmd/main.go command to generate hex files  (note: this will need to be
        // modified to work with receipt proofs instead of channel/packet proofs)
        // 2.) load these proof files into the test contracts using the load_proof util, e.g. using something like
        // Ics23Proof memory testProof = load_proof("/test/payload/channel_confirm_pending_proof.hex",
        // address(dummyLightClient));
        // 3.) Call the crossProver.validateEvent method to test

        vm.skip(true);
    }

    // Test valid peptide proof but invalid MMPT receipt proof
    function test_revert_invalidReceiptProof() public {
        // TODO: Fill this in once we have relaying to peptide working and that we can generate peptide state proof
        // using this tool in relayer code at polymerase/
        // 1.) Run the oprelayer/pkg/encoder/cmd/main.go command to generate hex files  (note: this will need to be
        // modified to work with receipt proofs instead of channel/packet proofs)
        // 2.) load these proof files into the test contracts using the load_proof util, e.g. using something like
        // Ics23Proof memory testProof = load_proof("/test/payload/channel_confirm_pending_proof.hex",
        // address(dummyLightClient));
        // 3.) Call the crossProver.validateReceipt method to test

        vm.skip(true);
    }

    // Test trying to prove with a non-existent peptideApphash that hasn't yet been seen
    function test_revert_nonexistingPeptideAppHash() public {
        string memory input = vm.readFile(string.concat(rootDir, "/test/payload/packet_ack_proof.hex"));
        bytes memory encoded = vm.parseBytes(input);
        (, Ics23Proof memory peptideProof) = abi.decode(encoded, (bytes32, Ics23Proof));

        // proof will be struct EventProof
        bytes memory proof = abi.encode(peptideProof, receiptProof, receiptRoot, peptideClientId, peptideBlockNumber);

        vm.expectRevert();
        crossProver.validateReceipt(proof);
    }

    // Test revert to prove a peptide apphash which has been seen but which doesn't prove the MPT receipt root given
    function test_revert_invalidReceiptRoot() public {
        // TODO: Fill this in once we have relaying to peptide working and that we can generate peptide state proof
        // using this tool in relayer code at polymerase/
        // 1.) Run the oprelayer/pkg/encoder/cmd/main.go command to generate hex files  (note: this will need to be
        // modified to work with receipt proofs instead of channel/packet proofs)
        // 2.) load these proof files into the test contracts using the load_proof util, e.g. using something like
        // Ics23Proof memory testProof = load_proof("/test/payload/channel_confirm_pending_proof.hex",
        // address(dummyLightClient));
        // 3.) Call the crossProver.validateReceipt method to test revert
    }

    // Test that a client update will fail if it doesn't have a valid sequencer signature
    function test_revert_invalidClentUpdateSignature() public {
        vm.expectRevert(ISignatureVerifier.InvalidSequencerSignature.selector);
        crossProver.updateClient(
            abi.encodePacked(l1AncestorBlockHash, invalidSignature), peptideBlockNumber, uint256(peptideAppHash)
        );
        assertEq(crossProver.getState(peptideBlockNumber), 0);
    }

    // Test valid receipt proof but invalid event in receipt
    function test_invalidEvent() public {
        // TODO: Fill this in once we have relaying to peptide working and that we can generate peptide state proof
        // using this tool in relayer code at polymerase/
        // 1.) Run the oprelayer/pkg/encoder/cmd/main.go command to generate hex files  (note: this will need to be
        // modified to work with receipt proofs instead of channel/packet proofs)
        // 2.) load these proof files into the test contracts using the load_proof util, e.g. using something like
        // Ics23Proof memory testProof = load_proof("/test/payload/channel_confirm_pending_proof.hex",
        // address(dummyLightClient));
        // 3.) Call the crossProver.validateEvent method to test revert

        vm.skip(true);
    }
}
